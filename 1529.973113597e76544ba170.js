"use strict";(self.webpackChunkmy_vue_app=self.webpackChunkmy_vue_app||[]).push([[1529],{41529:function(e,n,t){t.r(n),t.d(n,{default:function(){return ce}});var r,o,i,s,u,a,l,c,h,d,p,m,f,b=t(36568),v=t.n(b),g=t(27361),y=t.n(g),Z=t(36968),P=t.n(Z),N=t(82492),k=t.n(N),x=t(7903),S=t(70970),C=t(22705),I=t(2813),R=t(3587),w=t(21797),_=t(92317),V=t(82345),G=t(72283),L=t(20793),O=t(50125),F=t(17360),M=(t(41320),t(92222),t(69826),t(41539),t(21703),t(74916),t(15306),t(38880),t(14577)),z=t(95306),E=t(90416),A=t(30813),T=t(33990),B=t(90825),U=t(2799),D=t(81830),K=t(14614),W=t(81764),Y=t(98292),j=t(5836),q=t(71707),J=t(59700),Q=t(37694),X="pLJhdIa2JLgq0jGQMySa",H="wIa9XK8k2fcCP2n6JrFw",$="eA2cHa7kCUcyqQYmnO9F",ee="t8W3geTKKTNp0ppWUmrw",ne="HKMo2TPuX7Jt9kr0vcrS",te="urx6Ryx4lvEtAo57GF_B",re="Q6AoWHDUP7qGbDRL6Ei0",oe="EEWrS29j57_VKnxZpKcv",ie="DxC6gecvWsSCiApzNZwb",se="fxmtY3YgSsspWolkOvB_",ue="i4R0cXMRJL5ZT53BBwuv",ae="LoRGikxzzUUbU3VwgKGA",le=t(41800),ce=(r=(0,A.wA)({name:"VeriryBindPhone"}),o=(0,A.Rl)(),i=(0,A.Rl)(),s=(0,A.Rl)(),u=(0,A.Rl)(),a=(0,M.WY)(),l=(0,M.K4)(),r((h=function(e){(0,G.Z)(a,e);var n,t,r,o,i,s,u=(0,L.Z)(a);function a(){var e;(0,w.Z)(this,a);for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return e=u.call.apply(u,[this].concat(t)),(0,R.Z)((0,V.Z)(e),"phoneAuthInputRef",d,(0,V.Z)(e)),(0,R.Z)((0,V.Z)(e),"phoneNumberFormItemRef",p,(0,V.Z)(e)),(0,R.Z)((0,V.Z)(e),"formModel",m,(0,V.Z)(e)),(0,R.Z)((0,V.Z)(e),"smsVerificationRef",f,(0,V.Z)(e)),(0,O.Z)((0,V.Z)(e),"form",{username:"",userpass:"",phone:"",captcha:""}),(0,O.Z)((0,V.Z)(e),"openOptions",null),(0,O.Z)((0,V.Z)(e),"rules",{}),(0,O.Z)((0,V.Z)(e),"loading",!1),(0,O.Z)((0,V.Z)(e),"currentPhoneNumberSegment",""),(0,O.Z)((0,V.Z)(e),"isPhoneNumberChecking",!1),(0,O.Z)((0,V.Z)(e),"isPhoneNumberPassed",null),(0,O.Z)((0,V.Z)(e),"phoneNumberValidError",null),(0,O.Z)((0,V.Z)(e),"desensitizedPhoneNumber",""),e}return(0,_.Z)(a,[{key:"loginConfig",get:function(){var e=(0,Y.h)();return{countryInfos:e.countryInfos,defaultCountry:e.defaultCountry}}},{key:"phoneNumberFormat",get:function(){var e=this,n=this.form;if(!n.phone)return"";var t=this.loginConfig.countryInfos.find((function(n){return n.phoneNumberSegment===e.currentPhoneNumberSegment}));return"".concat(this.desensitizedPhoneNumber?"":"".concat(null==t?void 0:t.phoneNumberSegment,"-")).concat(n.phone)}},{key:"isBindPhone",get:function(){return this.desensitizedPhoneNumber}},{key:"userInfos",get:function(){return(0,Y.h)().userInfos}},{key:"tryInitCurrentPhoneNumberSegment",value:function(){var e,n,t,r,o=(0,Y.h)().systemInfos,i=null===(e=this.loginConfig)||void 0===e||null===(n=e.countryInfos)||void 0===n?void 0:n.find((function(e){return(null==e?void 0:e.phoneNumberSegment)===(null==o?void 0:o.recommendAreaCode)}));this.currentPhoneNumberSegment=i?i.phoneNumberSegment:(null===(t=this.loginConfig)||void 0===t||null===(r=t.defaultCountry)||void 0===r?void 0:r.phoneNumberSegment)||""}},{key:"open",value:(s=(0,I.Z)((0,S.Z)().mark((function e(n){var t,r,o,i,s,u;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=14;break}return e.next=3,Q.Z.initSmsCountry();case 3:if(this.openOptions=n,n.formData&&(this.form.username=n.formData.username,this.form.userpass=n.formData.userpass),n.verifyScene===U.O.LOGIN_SMS_VERIFY?this.desensitizedPhoneNumber=n.desensitizedPhoneNumber||"":null!==(t=this.userInfos)&&void 0!==t&&t.mobile_phone&&(this.desensitizedPhoneNumber=this.userInfos.mobile_phone),n.verifyScene===U.O.LOGIN_SMS_VERIFY||null!==(r=this.userInfos)&&void 0!==r&&r.mobile_phone){e.next=14;break}return e.next=9,(0,le.Z)((0,K.st)());case 9:o=e.sent,i=(0,C.Z)(o,2),s=i[0],u=i[1],s||(this.desensitizedPhoneNumber=u.phone);case 14:return this.tryInitCurrentPhoneNumberSegment(),e.next=17,this.baseOpen();case 17:this.reset();case 18:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"doLoginValidate",value:(i=(0,I.Z)((0,S.Z)().mark((function e(n){var t,r,o,i,s,u,a,l=arguments;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>1&&void 0!==l[1]?l[1]:{},r=t.forceGeetest){e.next=3;break}return e.abrupt("return");case 3:if(!r){e.next=17;break}if(!B.sG.User.checkGeetestRestricted()){e.next=6;break}return e.abrupt("return",Promise.reject());case 6:return o=(0,Y.h)(),i=o.systemInfos,s=r?null==i?void 0:i.geetest_captcha_id.force_geetest:null==i?void 0:i.geetest_captcha_id.login,e.next=10,B.sG.User.initGeetest({geetestConfig:{captchaId:s||""}});case 10:return u=e.sent,e.next=13,new Promise((function(e,n){null==u||u.onSuccess((function(){e(u.getValidate())})).onClose((function(){u.destroy(),n()})).onError((function(){u.destroy(),n()}))}));case 13:if(!(a=e.sent)){e.next=17;break}return e.next=17,B.sG.User.validateGeetest((0,x.Z)({account:n.username},a));case 17:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"doLogin",value:(o=(0,I.Z)((0,S.Z)().mark((function e(n){var t,r,o=arguments;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:{},r=t.forceGeetest,e.next=3,this.smsVerificationRef.valid();case 3:return e.next=5,this.doLoginValidate(n,{forceGeetest:r});case 5:return e.abrupt("return",B.sG.User.login(n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"doSmsLoginSubmit",value:(r=(0,I.Z)((0,S.Z)().mark((function e(){var n,t,r,o,i,s,u,a=this,l=arguments;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>0&&void 0!==l[0]?l[0]:{},t=n.forceGeetest,!this.loading){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this.formModel.validate();case 6:return this.loading=!0,e.next=9,this.doLogin((0,x.Z)((0,x.Z)({},this.form),{},{phone:this.phoneNumberFormat}),{forceGeetest:t}).finally((function(){a.loading=!1}));case 9:(0,(0,j.R)().$patch)({isLoginedByPassword:!0,loginPass:this.form.userpass}),null===(r=this.openOptions)||void 0===r||null===(o=r.onSuccess)||void 0===o||o.call(r),this.close(),e.next=25;break;case 15:if(e.prev=15,e.t0=e.catch(3),i=B.CM.ServiceCode,s=null===e.t0||void 0===e.t0?void 0:e.t0.data,(u=null==s?void 0:s.code)!==i.LOGIN_ERROR&&u!==i.ACCOUNT_FREEZE){e.next=24;break}return e.next=23,this.close();case 23:B.sG.Modal.open("loginModal");case 24:console.error(e.t0);case 25:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(){return r.apply(this,arguments)})},{key:"doRiskSumit",value:(t=(0,I.Z)((0,S.Z)().mark((function e(){var n,t,r,o,i,s,u,a,l,c,h,d,p,m,f=this;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loading){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.formModel.validate();case 4:if(this.loading=!0,t={phone:this.phoneNumberFormat,captcha:this.form.captcha,scene:null===(n=this.openOptions)||void 0===n?void 0:n.verifyScene},!this.isBindPhone){e.next=15;break}return e.next=9,(0,le.Z)((0,D.apiRiskVerifyPhone)(t).finally((function(){f.loading=!1})));case 9:r=e.sent,(0,C.Z)(r,1)[0]||(null===(o=this.openOptions)||void 0===o||null===(i=o.onSuccess)||void 0===i||i.call(o),this.close()),e.next=28;break;case 15:return e.next=17,(0,le.Z)((0,D.apiRiskBindPhone)(t).finally((function(){f.loading=!1})));case 17:if(s=e.sent,(0,C.Z)(s,1)[0]){e.next=28;break}return e.next=23,(0,le.Z)((0,K.st)());case 23:u=e.sent,a=(0,C.Z)(u,2),l=a[0],c=a[1],l||(p=(0,Y.h)(),m=p.userInfos,(0,p.updateUserInfos)(k()({},m,{mobile_phone:null==c?void 0:c.phone})),null===(h=this.openOptions)||void 0===h||null===(d=h.onSuccess)||void 0===d||d.call(h),this.close());case 28:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isLoginVerify",get:function(){var e;return(null===(e=this.openOptions)||void 0===e?void 0:e.verifyScene)===U.O.LOGIN_SMS_VERIFY}},{key:"onSubmit",value:function(){this.isLoginVerify?this.doSmsLoginSubmit():this.doRiskSumit()}},{key:"reset",value:function(){var e;this.isPhoneNumberPassed=null,null===(e=this.phoneAuthInputRef)||void 0===e||e.clear()}},{key:"afterClose",value:function(){this.baseAfterClose()}},{key:"validPhoneNumberInput",value:(n=(0,I.Z)((0,S.Z)().mark((function e(n){var t,r,o,i,s,u,a;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length<(null===(t=this.desensitizedPhoneNumber)||void 0===t?void 0:t.length))){e.next=3;break}return this.isPhoneNumberPassed=null,e.abrupt("return",Promise.reject(new Error));case 3:return o=this.form.username,i=(null===(r=this.openOptions)||void 0===r?void 0:r.verifyScene)===U.O.LOGIN_SMS_VERIFY?(0,D.apiVerifyPhoneNumberCaptcha)({phone:n,username:o},{silentOnError:!0}):(0,D.apiVerifyPhoneNumberAfterLogin)({phone:n},{silentOnError:!0}),this.isPhoneNumberChecking=!0,e.next=8,(0,le.Z)(i);case 8:if(s=e.sent,u=(0,C.Z)(s,1),a=u[0],this.phoneNumberValidError=a,this.isPhoneNumberChecking=!1,this.isPhoneNumberPassed=!a,!a){e.next=16;break}return e.abrupt("return",Promise.reject(a));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this,n=arguments[0],t=(0,W.QT)(),r=t.t,o=B.sG.FuncRender.createFormModelItem.call(this);return this.renderModal({modalConfig:{class:X,props:{title:r("lobby.common.components.auth.phone.title"),width:q.ZP.px2rem(600),afterClose:function(){var n;return null===(n=e.formModel)||void 0===n?void 0:n.resetFields()}}},renderContent:function(){var t,i,s,u;return n(z.T.Tsx,{attrs:{direction:"vertical",size:14},class:H},[n(z.au.Tsx,v()([{ref:"formModel",attrs:{layout:"vertical",hideRequiredMark:!0}},{props:{rules:e.rules,model:e.form}}]),[e.isBindPhone?[n("div",{class:ee,key:"infos"},[n("span",{class:ne},[r("lobby.common.components.auth.phone.current")]),n("span",{class:te},[null===(t=e.desensitizedPhoneNumber)||void 0===t?void 0:t.replace("-"," ")])]),o.custom({hiddenPrefix:!0,showLabel:!0,prop:"phone",model:e.form,formModelItemTsxData:{class:[re],ref:"phoneNumberFormItemRef",props:{autoLink:!1,help:function(){var t,o,i;return n("div",{class:[oe,e.isPhoneNumberPassed?ae:""]},[n("div",{class:se}),n("div",{class:ie},[e.isPhoneNumberChecking?r("lobby.common.tips.validating"):null===e.isPhoneNumberPassed?r("lobby.common.components.auth.phone.required",{length:null===(t=q.ZP.phoneNumberParse(e.desensitizedPhoneNumber))||void 0===t?void 0:t.placeholder.length}):!0===e.isPhoneNumberPassed?r("lobby.common.components.auth.phone.success"):!1===e.isPhoneNumberPassed?1216===(null===(o=e.phoneNumberValidError)||void 0===o?void 0:o.data.code)?r("lobby.common.components.auth.phone.error"):null===(i=e.phoneNumberValidError)||void 0===i?void 0:i.data.msg:void 0]),n("div",{class:ue})])},rules:[B.sG.Rules.create({trigger:["blur","change"],asyncValidator:(u=(0,I.Z)((0,S.Z)().mark((function n(t,r,o){var i;return(0,S.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,le.Z)(e.validPhoneNumberInput(r));case 2:if(i=n.sent,!(0,C.Z)(i,1)[0]){n.next=7;break}return n.abrupt("return",o(""));case 7:return n.abrupt("return",o());case 8:case"end":return n.stop()}}),n)}))),function(e,n,t){return u.apply(this,arguments)})})]}},render:function(){return n(E.Ql,{ref:"phoneAuthInputRef",on:{complete:function(){var n;null===(n=e.phoneNumberFormItemRef)||void 0===n||n.onFieldBlur()},input:function(n){var t;(P()(e.form,"phone",n),n)&&(null===(t=e.phoneNumberFormItemRef)||void 0===t||t.onFieldChange())}},attrs:{disabled:!!e.isPhoneNumberPassed,value:y()(e.form,"phone"),phoneNumberTemplate:e.desensitizedPhoneNumber}})}})]:[(null===(i=e.loginConfig)||void 0===i?void 0:i.defaultCountry)&&o.userPhoneSelect({hiddenPrefix:!0,showLabel:!0,prop:"phone",model:e.form,countryInfos:e.loginConfig.countryInfos,defaultCountry:null===(s=e.loginConfig)||void 0===s?void 0:s.defaultCountry,currentPhoneNumberSegment:e.currentPhoneNumberSegment,inputTsxData:{attrs:{placeholder:r("lobby.center.security.phone.phonePlaceholder")}},onSelectChange:function(n){e.currentPhoneNumberSegment=n,e.form.phone=""}})],n(E.F0,{attrs:{hiddenPrefix:!0,showLabel:!0,prop:"captcha",getCodeFunPromise:e.isLoginVerify?void 0:function(e){return(0,D.apiGetSmsCodeAfterLogined)({create_mode:T.FW.Verify,limit_type:"phone",phone_number:e})},disabled:!!e.isBindPhone&&!e.isPhoneNumberPassed,targetValue:e.phoneNumberFormat},ref:"smsVerificationRef",model:{value:e.form.captcha,callback:function(n){e.$set(e.form,"captcha",n)}}})]),n(z.X2.Tsx,{attrs:{type:"flex",justify:"center"},class:$},[n(z.zx.Tsx,{style:{width:"100%",height:q.ZP.px2rem(55)},attrs:{type:"primary",loading:e.loading,block:!0},on:{click:e.onSubmit}},[r("lobby.modal.passModal.ok")])])])}})}}]),a}(J.Z),d=(0,F.Z)(h.prototype,"phoneAuthInputRef",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=(0,F.Z)(h.prototype,"phoneNumberFormItemRef",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=(0,F.Z)(h.prototype,"formModel",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=(0,F.Z)(h.prototype,"smsVerificationRef",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,F.Z)(h.prototype,"onSubmit",[a,l],Object.getOwnPropertyDescriptor(h.prototype,"onSubmit"),h.prototype),c=h))||c)}}]);