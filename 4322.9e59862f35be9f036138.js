"use strict";(self.webpackChunkmy_vue_app=self.webpackChunkmy_vue_app||[]).push([[4322],{59449:function(e,t,r){r.r(t),r.d(t,{default:function(){return Ue}});var o,n=r(7903),a=r(70970),i=r(2813),s=r(3587),l=r(21797),u=r(92317),c=r(82345),d=r(72283),p=r(20793),h=r(50125),f=r(17360),m=(r(41320),r(92222),r(21249),r(38880),r(30813)),y=r(90825),v=r(72433),b=r(95306),g=r(33990),w=r(40469);!function(e){e[e.AUTH=0]="AUTH",e[e.UPDATE=1]="UPDATE",e[e.DONE=2]="DONE"}(o||(o={}));var Z,S,_,k,C,P,R,T,x,M,O,E,A=(0,w.Q_)("global-modal/forgot-password",{state:function(){return{username:"",accountVerifyList:null,currentStep:o.AUTH,canResetPwd:!1}},getters:{validateConfig:function(){var e=this.accountVerifyList,t=(null==e?void 0:e.a.email)||"",r=(null==e?void 0:e.a.mobile_phone)||"";return{email:t,phoneNumber:r,hasQuestion:!(null==e||!e.b.question),hasWithdrawPwd:(null==e?void 0:e.b.withdraw_password)===g.Fb.OPEN,hasGoogleAuth:(null==e?void 0:e.a.is_open_google_auth)===g.SF.ON,hasEmail:!!t,hasPhoneNumber:!!r}}},actions:{setStep:function(e){this.currentStep=e}}}),D=r(81764),V=r(98292),N=r(71707),F=r(59700),I=r(36568),L=r.n(I),U=r(82492),G=r.n(U),q=r(57557),H=r.n(q),W=r(22705),z=(r(41539),r(78783),r(33948),r(47941),r(14577)),j=r(37155),Y=r(81830),Q=r(63445),X=r(86493),K=r(80005),B=r(83110),$=r(80897),J="dVcrVAhaF7F3FMS1CHgd",ee="FHKvk_2Z7RDcwcOAVg1J",te="df15kCedcxS_03LfokDh",re="a1efIfU7vchFIGInfRhe",oe="N0CRgeEAXgmO0jQ2Xj8I",ne="PtX1zjfdX8hxyKSlmLhw",ae="v6hju3cXblAJtrJ1Bivd",ie="epU4bDH9dqeX5Hd83a4F",se="hAa7RDk2woBeRvZyDeqr",le="mJqaBUwdO54uyMJbHOjM",ue="bPtNPwi8tx8YqjiZIeL_",ce="bsw6_G2Y0FVAaB4DTsMb",de="yYbEaiQsUnq_HZAMZbUY",pe="GagpXsPoU9Yu9MdHy9Qf";!function(e){e.NONE="",e.CHECKING="checking",e.ACCOUNT_ERROR="accountError",e.VALIDATION_RULES_ERROR="validationRulesError",e.WAIT_SELF_VERIFY="waitSelfVerify"}(E||(E={}));var he,fe,me,ye,ve,be,ge,we,Ze,Se,_e,ke,Ce,Pe,Re,Te,xe,Me,Oe=(Z=(0,m.wA)({name:"PasswordAuth"}),S=(0,m.Rl)(),_=(0,z.WY)(),k=(0,z.K4)(),C=(0,m.RL)("validateStatus"),P=(0,z.WY)(),R=(0,z.K4)(),T=(0,m.RL)("validMode"),Z((M=function(e){(0,d.Z)(w,e);var t,r,f,m,g=(0,p.Z)(w);function w(){var e;(0,l.Z)(this,w);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return e=g.call.apply(g,[this].concat(r)),(0,s.Z)((0,c.Z)(e),"formModel",O,(0,c.Z)(e)),(0,h.Z)((0,c.Z)(e),"validMode",K.W.WITH_WITHDRAW_PWD),(0,h.Z)((0,c.Z)(e),"isSubmitting",!1),(0,h.Z)((0,c.Z)(e),"validateStatus",E.NONE),(0,h.Z)((0,c.Z)(e),"form",{username:"",withdraw_pass:"",pass_question_id:0,pass_question_answer:"",google_code:"",email:"",email_code:"",phone:"",phone_code:""}),e}return(0,u.Z)(w,[{key:"checkHasVerifyMethods",value:(m=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,n,i,s,l,u,c,d,p,h,f=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=A(),r=(0,V.h)(),n=r.getUserSecurityStepsList,e.prev=2,e.next=5,this.formModel.validate();case 5:return this.isSubmitting=!0,this.validateStatus=E.CHECKING,e.next=9,Promise.all([(0,Y.apiGetNotLoginAccountVerifyList)({username:this.form.username},{customParams:{silentOnError:!0}}),(0,X.gw)(500)]).finally((function(){return f.isSubmitting=!1}));case 9:if(i=e.sent,s=(0,W.Z)(i,1),l=s[0],t.$patch({accountVerifyList:l.data.data||null}),u=n(t.validateConfig,j.zy.FORGOT_PASSWORD),c=u.first_verify,d=u.last_verify,c.length||d.length){e.next=17;break}return this.validateStatus=E.VALIDATION_RULES_ERROR,e.abrupt("return");case 17:if(this.validateStatus=E.WAIT_SELF_VERIFY,c.length){e.next=21;break}return t.setStep(o.UPDATE),e.abrupt("return");case 21:this.validMode=c[0],e.next=28;break;case 24:e.prev=24,e.t0=e.catch(2),0===(null==(h=e.t0)||null===(p=h.data)||void 0===p?void 0:p.code)?this.validateStatus=E.ACCOUNT_ERROR:this.validateStatus=E.NONE;case 28:t.$patch({username:this.form.username});case 29:case"end":return e.stop()}}),e,this,[[2,24]])}))),function(){return m.apply(this,arguments)})},{key:"onValidateStatusChange",value:function(){A().$patch({username:this.form.username,canResetPwd:this.validateStatus===E.WAIT_SELF_VERIFY})}},{key:"waitForSelfVerify",get:function(){return this.validateStatus===E.WAIT_SELF_VERIFY}},{key:"validTypeConfig",get:function(){var e=A();return(0,(0,V.h)().getUserSecurityStepsList)(e.validateConfig,j.zy.FORGOT_PASSWORD).first_verify}},{key:"doGeetestValidate",value:(f=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,o,i,s,l=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(l.length>0&&void 0!==l[0]?l[0]:{}).forceGeetest){e.next=14;break}if(!y.sG.User.checkGeetestRestricted()){e.next=4;break}return e.abrupt("return",Promise.reject());case 4:return t=(0,V.h)(),r=t.systemInfos,o=t.uuid,e.next=7,y.sG.User.initGeetest({geetestConfig:{captchaId:(null==r?void 0:r.geetest_captcha_id.force_geetest)||""}});case 7:return i=e.sent,e.next=10,new Promise((function(e,t){null==i||i.onSuccess((function(){e(i.getValidate())})).onClose((function(){i.destroy(),t()})).onError((function(){i.destroy(),t()}))}));case 10:if(!(s=e.sent)){e.next=14;break}return e.next=14,y.sG.User.validateGeetest((0,n.Z)({account:o},s));case 14:case"end":return e.stop()}}),e)}))),function(){return f.apply(this,arguments)})},{key:"doSubmit",value:(r=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,i,s,l,u,c=this,d=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]?d[0]:{},r=t.forceGeetest,e.prev=1,!this.isSubmitting){e.next=4;break}return e.abrupt("return");case 4:return i=(0,X.Fr)(this.formModel.validateField),s={username:this.form.username,firstVerify:(0,n.Z)({type:this.validMode},H()(this.form,["username"]))},e.next=8,i(Object.keys(H()(s.firstVerify,["type"])));case 8:return this.isSubmitting=!0,e.next=11,this.doGeetestValidate({forceGeetest:r});case 11:return e.next=13,(0,Q.p)(s).finally((function(){c.isSubmitting=!1}));case 13:A().setStep(o.UPDATE),e.next=23;break;case 17:e.prev=17,e.t0=e.catch(1),this.isSubmitting=!1,u=y.CM.ServiceCode.FORCE_GEETEST,(null===e.t0||void 0===e.t0||null===(l=e.t0.data)||void 0===l?void 0:l.code)===u&&this.doSubmit({forceGeetest:!0}),console.error("error",e.t0);case 23:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(){return r.apply(this,arguments)})},{key:"onSubmit",value:(t=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.doSubmit();case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onValidModeChange",value:function(){var e=A().accountVerifyList;this.form=G()(this.form,{withdraw_pass:"",pass_question_id:$.Z.isEmpty(null==e?void 0:e.b.question)?-1:null==e?void 0:e.b.question,pass_question_answer:"",google_code:"",email:"",email_code:"",phone:"",phone_code:""})}},{key:"render",value:function(){var e=this,t=arguments[0],r=(0,D.QT)(),o=r.t,n=A(),a=n.validateConfig,i=a.email,s=a.phoneNumber,l=y.sG.FuncRender.createFormModelItem.call(this);return t("div",{class:[le]},[t(b.au.Tsx,L()([{ref:"formModel",attrs:{hideRequiredMark:!0}},{props:{model:this.form}}]),[[l.username({showLabel:!0,hiddenPrefix:!0,label:o("lobby.modal.login.form.username.labelShort"),prop:"username",model:this.form,inputTsxData:{attrs:{placeholder:o("lobby.modal.login.form.username.placeholder")},on:{change:function(){e.validateStatus=E.NONE}}},formModelItemTsxData:{props:{help:function(){switch(e.validateStatus){case E.ACCOUNT_ERROR:case E.VALIDATION_RULES_ERROR:return t(B.Z,{attrs:{showIcon:!0,mode:"AccountException"},class:ce});default:return""}}}}}),this.waitForSelfVerify?t("div",{class:[de]},[t("div",{class:[pe]}),t(K.Z,{attrs:{username:n.username,desensitizedEmail:i,questionIdProp:"pass_question_id",desensitizedPhoneNumber:s,formModel:this.form,validTypeConfig:this.validTypeConfig,isForgetPassword:!0},model:{value:e.validMode,callback:function(t){e.validMode=t}}}),t(v.h_,{attrs:{to:y.CM.PortalName.ForgotPwdBtns}},[t(b.zx.Tsx,{attrs:{loading:this.isSubmitting,type:"primary",block:!0},class:ie,on:{click:this.onSubmit}},[o("lobby.common.tips.next")])])]):t(b.zx.Tsx,{attrs:{loading:this.isSubmitting,type:"primary",block:!0},class:[ie,ue],on:{click:this.checkHasVerifyMethods}},[this.validateStatus===E.CHECKING?o("lobby.common.tips.validating"):o("lobby.common.tips.next")])]])])}}]),w}(m.XY),O=(0,f.Z)(M.prototype,"formModel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,f.Z)(M.prototype,"checkHasVerifyMethods",[_,k],Object.getOwnPropertyDescriptor(M.prototype,"checkHasVerifyMethods"),M.prototype),(0,f.Z)(M.prototype,"onValidateStatusChange",[C],Object.getOwnPropertyDescriptor(M.prototype,"onValidateStatusChange"),M.prototype),(0,f.Z)(M.prototype,"onSubmit",[P,R],Object.getOwnPropertyDescriptor(M.prototype,"onSubmit"),M.prototype),(0,f.Z)(M.prototype,"onValidModeChange",[T],Object.getOwnPropertyDescriptor(M.prototype,"onValidModeChange"),M.prototype),x=M))||x),Ee="gAeCSJc77vRMKw0WBfpM",Ae="aWoPonp_VzkV2TlkaYOW",De="gcVhiqzd7dcFeajZy6GV",Ve="ricS9k3DIq971atPaJ8L",Ne=(he=(0,m.wA)({name:"PasswordDone"}),fe=(0,m.y1)("dispatch"),he((ye=function(e){(0,d.Z)(r,e);var t=(0,p.Z)(r);function r(){return(0,l.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"onDispatch",value:function(e){return e}},{key:"render",value:function(){var e=arguments[0],t=(0,D.QT)(),r=t.t;return e("div",{class:[Ee]},[e("div",{class:[Ae]},[e("i"),e("span",[r("lobby.modal.forgotPassword.resetSuccess")])]),e("div",{class:[De]},[e(b.zx.Tsx,{attrs:{type:"default"},class:[ie,Ve],on:{click:this.onDispatch.bind(this,{type:"back-home"})}},[r("lobby.modal.forgotPassword.backHome")]),e(b.zx.Tsx,{attrs:{type:"primary"},class:[ie,Ve],on:{click:this.onDispatch.bind(this,{type:"login-now"})}},[r("lobby.modal.forgotPassword.loginNow")])])])}}]),r}(m.XY),(0,f.Z)(ye.prototype,"onDispatch",[fe],Object.getOwnPropertyDescriptor(ye.prototype,"onDispatch"),ye.prototype),me=ye))||me),Fe=r(50308),Ie=r.n(Fe),Le=(ve=(0,m.wA)({name:"PasswordUpdate"}),be=(0,m.Rl)(),ge=(0,z.WY)(),we=(0,z.K4)(),Ze=(0,m.RL)("validMode"),ve((_e=function(e){(0,d.Z)(f,e);var t,r=(0,p.Z)(f);function f(){var e;(0,l.Z)(this,f);for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];return e=r.call.apply(r,[this].concat(o)),(0,s.Z)((0,c.Z)(e),"formModel",ke,(0,c.Z)(e)),(0,h.Z)((0,c.Z)(e),"validMode",K.W.WITH_GA),(0,h.Z)((0,c.Z)(e),"isSubmitting",!1),(0,h.Z)((0,c.Z)(e),"formModelValidRecord",{}),(0,h.Z)((0,c.Z)(e),"form",{username:"",password:"",passwordConfirm:"",withdraw_pass:"",pass_question_id:0,pass_question_answer:"",google_code:"",email:"",email_code:"",phone:"",phone_code:""}),e}return(0,u.Z)(f,[{key:"mounted",value:function(){this.validMode=this.validTypeConfig[0]}},{key:"validTypeConfig",get:function(){var e=A();return(0,(0,V.h)().getUserSecurityStepsList)(e.validateConfig,j.zy.FORGOT_PASSWORD).last_verify}},{key:"onSubmit",value:(t=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,i,s=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.isSubmitting){e.next=3;break}return e.abrupt("return");case 3:return t=A(),r=this.form.password,i={username:t.username,password:r,second_verify:(0,n.Z)({type:this.validMode||0},H()(this.form,["username","password","passwordConfirm"]))},e.next=8,this.formModel.validate();case 8:return this.isSubmitting=!0,e.next=11,(0,Q.AW)(i).finally((function(){s.isSubmitting=!1}));case 11:t.setStep(o.DONE),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(){return t.apply(this,arguments)})},{key:"onValidate",value:function(e,t){this.$set(this.formModelValidRecord,e,t)}},{key:"onValidModeChange",value:function(){var e=A().accountVerifyList;this.form=G()(this.form,{withdraw_pass:"",pass_question_id:$.Z.isEmpty(null==e?void 0:e.b.question)?-1:null==e?void 0:e.b.question,pass_question_answer:"",google_code:"",email:"",email_code:"",phone:"",phone_code:""})}},{key:"render",value:function(){var e=this,t=arguments[0],r=(0,D.QT)(),o=r.t,n=A(),a=n.validateConfig,i=a.email,s=a.phoneNumber,l=y.sG.FuncRender.createFormModelItem.call(this);return t("div",{class:[le]},[t(b.au.Tsx,L()([{ref:"formModel",attrs:{hideRequiredMark:!0},on:{validate:this.onValidate}},{props:{model:this.form}}]),[[l.userpass({showLabel:!0,hiddenPrefix:!0,label:o("lobby.modal.forgotPassword.newPassword"),prop:"password",inputTsxData:{attrs:{placeholder:o("lobby.center.security.loginPwd.newPwd.placeholder")}},getRules:function(t){return[t.required,t.pattern,{validator:function(t,r,o){return e.form.passwordConfirm&&e.formModel.validateField(["passwordConfirm"],Ie()),o(),!0}}]},model:this.form}),l.userpass({showLabel:!0,hiddenPrefix:!0,prop:"passwordConfirm",label:o("lobby.modal.register.passwdConfirm"),inputTsxData:{attrs:{placeholder:o("lobby.center.security.loginPwd.confirmNewPwd.placeholder")}},model:this.form,getRules:function(t){return[y.sG.Rules.required({requiredItem:function(){return o("lobby.modal.register.passwdConfirm")}}),t.pattern,{validator:function(t,r,n){return r!==e.form.password&&n(o("lobby.modal.register.notMatch")),n(),!0}}]}}),t("div",{class:[de]},[t("div",{class:[pe]}),this.validTypeConfig.length>0&&t(K.Z,{attrs:{username:n.username,desensitizedEmail:i,desensitizedPhoneNumber:s,formModel:this.form,isForgetPassword:!0,validTypeConfig:this.validTypeConfig},model:{value:e.validMode,callback:function(t){e.validMode=t}}}),t(v.h_,{attrs:{to:y.CM.PortalName.ForgotPwdBtns}},[t(b.zx.Tsx,{attrs:{loading:this.isSubmitting,type:"primary",block:!0},class:ie,on:{click:this.onSubmit}},[o("lobby.common.tips.confirm")])])])]])])}}]),f}(m.XY),ke=(0,f.Z)(_e.prototype,"formModel",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,f.Z)(_e.prototype,"onSubmit",[ge,we],Object.getOwnPropertyDescriptor(_e.prototype,"onSubmit"),_e.prototype),(0,f.Z)(_e.prototype,"onValidModeChange",[Ze],Object.getOwnPropertyDescriptor(_e.prototype,"onValidModeChange"),_e.prototype),Se=_e))||Se),Ue=(Ce=(0,m.wA)({name:"ForgotPasswordModal"}),Pe=(0,m.Rl)(),Re=(0,m.RL)("currentStep"),Ce((xe=function(e){(0,d.Z)(m,e);var t,r,f=(0,p.Z)(m);function m(){var e;(0,l.Z)(this,m);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return e=f.call.apply(f,[this].concat(r)),(0,s.Z)((0,c.Z)(e),"scrollContainer",Me,(0,c.Z)(e)),e}return(0,u.Z)(m,[{key:"stepsList",get:function(){var e=(0,D.QT)().t;return[{id:o.AUTH,label:e("lobby.modal.forgotPassword.step1")},{id:o.UPDATE,label:e("lobby.modal.forgotPassword.step2")},{id:o.DONE,label:e("lobby.modal.forgotPassword.step3")}]}},{key:"currentStep",get:function(){return A().currentStep}},{key:"onCurrentStepChanged",value:function(){var e=this;this.$nextTick((function(){var t;null===(t=e.scrollContainer)||void 0===t||t.scrollTo({x:0,y:0},0)}))}},{key:"open",value:(r=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.baseOpen();case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"afterClose",value:function(){var e=(0,V.h)(),t=e.enterPagePopupType,r=e.$patch;3===t&&r({enterPagePopupType:0}),A().$reset(),this.baseAfterClose()}},{key:"handleActions",value:(t=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("back-home"===t.type&&this.close(),"login-now"!==t.type){e.next=5;break}return e.next=4,this.close();case 4:y.sG.Modal.open("loginModal");case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"renderContent",value:function(){var e=this,t=this.$createElement;switch(A().currentStep){case o.AUTH:return t(Oe);case o.UPDATE:return t(Le);case o.DONE:return t(Ne,{on:{dispatch:function(t){e.handleActions(t)}}})}}},{key:"render",value:function(){var e=this,t=arguments[0],r=(0,D.QT)(),a=r.t,i=(0,V.h)(),s=i.isWeb,l=A();return this.renderModal({modalConfig:{class:[J],props:{width:N.ZP.px2rem(s?600:690)}},renderContent:function(){var r;return[t("template",{slot:"title"},[t("span",[a("lobby.modal.forgotPassword.title")])]),t("section",{class:(r={},(0,h.Z)(r,ee,!0),(0,h.Z)(r,se,l.currentStep===o.UPDATE),r)},[t("div",{class:[te]},[t(b.Rg.Tsx,{attrs:{current:l.currentStep,labelPlacement:"vertical"}},[e.stepsList.map((function(e,r){return t(b.Rg.Step.Tsx,{key:e.id,props:(0,n.Z)({},{title:e.label})},[t("span",{slot:"icon"},[r+1])])}))])]),t("div",{class:[re]},[t("div",{class:[oe,(0,h.Z)({},ne,!l.canResetPwd||l.currentStep===o.DONE)]},[t("my-scroll",{ref:"scrollContainer",class:[ae],attrs:{direction:"y"}},[e.renderContent()])]),t(v.YC,{attrs:{name:y.CM.PortalName.ForgotPwdBtns}})])])]}})}}]),m}(F.Z),Me=(0,f.Z)(xe.prototype,"scrollContainer",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,f.Z)(xe.prototype,"onCurrentStepChanged",[Re],Object.getOwnPropertyDescriptor(xe.prototype,"onCurrentStepChanged"),xe.prototype),Te=xe))||Te)}}]);