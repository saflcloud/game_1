"use strict";(self.webpackChunkmy_vue_app=self.webpackChunkmy_vue_app||[]).push([[925],{35350:function(e,t){t.Z={main:"CDf0ORRM8ElRiMfse8GI",tabs:"ABqIpTgbM_KYwiYYwb74",threeWayLogin:"_xcZWaOX6zgCk5FDNNtT",passwordTools:"B6J4DvKVDkYfnohvPisB",loginTools:"xEpW_WEg7K2LKvIHONxv",mainBtn:"RVYJOzKHDoOLNbvHfw4Q","check-box-container":"SLjcsWcVmMYAnFwnsBKX","check-box-label":"_4pVpDh9W5aV9_K7nAWK",button:"kKDcOuN8rOwl8zAHU1CF",loginMain:"dyTo46Ihqe6_GhjKL_8e"}},50925:function(e,t,n){n.r(t),n.d(t,{LoginType:function(){return h},default:function(){return B}});var o,r,i,s,a,l,u,c,p,h,d=n(36568),f=n.n(d),g=n(22705),m=n(7903),y=n(50361),v=n.n(y),b=n(70970),T=n(2813),C=n(3587),k=n(21797),S=n(92317),Z=n(82345),x=n(72283),P=n(20793),w=n(50125),E=n(17360),I=(n(41320),n(92222),n(69826),n(41539),n(26699),n(32023),n(21249),n(38880),n(14577)),M=n(95306),N=n(90416),O=n(33990),_=n(30813),G=n(12322),A=n(90825),L=n(76937),R=n(2799),U=n(81830),F=n(81764),D=n(98292),K=n(5836),V=n(71707),W=n(59700),$=n(37694),z=n(79959),X=n(35350),j=n(41800);!function(e){e.ACCOUNT="ACCOUNT",e.SMS="SMS"}(h||(h={}));var B=(o=(0,_.wA)({name:"LoginModal"}),r=(0,_.Rl)(),i=(0,_.Rl)(),s=(0,I.WY)(),a=(0,I.K4)(500),o((u=function(e){(0,x.Z)(l,e);var t,n,o,r,i,s,a=(0,P.Z)(l);function l(){var e;(0,k.Z)(this,l);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=a.call.apply(a,[this].concat(n)),(0,C.Z)((0,Z.Z)(e),"formModel",c,(0,Z.Z)(e)),(0,C.Z)((0,Z.Z)(e),"smsVerificationRef",p,(0,Z.Z)(e)),(0,w.Z)((0,Z.Z)(e),"activeKey","normal"),(0,w.Z)((0,Z.Z)(e),"form",{phone:"",vcode:"",username:"",userpass:""}),(0,w.Z)((0,Z.Z)(e),"openOptions",null),(0,w.Z)((0,Z.Z)(e),"rules",{}),(0,w.Z)((0,Z.Z)(e),"loading",!1),(0,w.Z)((0,Z.Z)(e),"currentPhoneNumberSegment",""),(0,w.Z)((0,Z.Z)(e),"loginType",h.ACCOUNT),e}return(0,S.Z)(l,[{key:"tabsData",get:function(){return[{key:"normal",tab:(0,(0,F.QT)().t)("lobby.modal.login.label"),renderContent:this.renderNormal}]}},{key:"loginConfig",get:function(){var e=(0,D.h)(),t=e.systemInfos,n=e.countryInfos,o=e.defaultCountry,r=t||{},i=r.enable_using_sms,s=r.loginQuickEntryFree,a=r.loginQuickEntryInstant,l=r.loginQuickEntrySms;return{showSMSLogin:i===O.AI.OPEN&&l===O.AI.OPEN,showTryItFree:s===O.AI.OPEN,showRegisterAccount:a===O.AI.OPEN,countryInfos:n,defaultCountry:o}}},{key:"tryInitCurrentPhoneNumberSegment",value:function(){var e,t,n,o=(0,D.h)().systemInfos,r=null===(e=this.loginConfig)||void 0===e||null===(t=e.countryInfos)||void 0===t?void 0:t.find((function(e){return(null==e?void 0:e.phoneNumberSegment)===(null==o?void 0:o.recommendAreaCode)}));this.currentPhoneNumberSegment=r?r.phoneNumberSegment:(null===(n=this.loginConfig.defaultCountry)||void 0===n?void 0:n.phoneNumberSegment)||""}},{key:"phoneNumberFormat",get:function(){var e,t,n=this,o=this.form;if(!o.phone)return"";var r=null===(e=this.loginConfig)||void 0===e||null===(t=e.countryInfos)||void 0===t?void 0:t.find((function(e){return e.phoneNumberSegment===n.currentPhoneNumberSegment}));return"".concat((null==r?void 0:r.phoneNumberSegment)||"","-").concat(o.phone)}},{key:"open",value:(s=(0,T.Z)((0,b.Z)().mark((function e(t){var n,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,D.h)(),(o=n.lastLoginedUsername)&&(this.form.username=o),t&&(t.loginType&&(this.loginType=t.loginType),this.openOptions=t),$.Z.initSmsCountry(),A.sG.User.updateSysinfoToken(),this.baseOpen();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"toRegister",value:(i=(0,T.Z)((0,b.Z)().mark((function e(){var t,n,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,D.h)(),n=t.enterPagePopupType,o=t.$patch,1===n&&o({enterPagePopupType:2}),e.next=4,this.close();case 4:A.sG.Modal.open("registerModal");case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"toForgetPassword",value:(r=(0,T.Z)((0,b.Z)().mark((function e(){var t,n,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,D.h)(),n=t.enterPagePopupType,o=t.$patch,1===n&&o({enterPagePopupType:3}),e.next=4,this.close();case 4:A.sG.Modal.open("forgotPasswordModal");case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"loginPayloadFormat",value:function(e){var t=v()(e);return"SMS"===this.loginType&&(t.phone=this.phoneNumberFormat),t}},{key:"doLoginValidate",value:(o=(0,T.Z)((0,b.Z)().mark((function e(t){var n,o,r,i,s,a,l,u,c,p,h,d,f,y,v,T,C,k=this,S=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=S.length>1&&void 0!==S[1]?S[1]:{},o=n.code,r=n.geetCaptchaId,i=A.CM.ServiceCode,!(s=o===i.FORCE_GEETEST)&&!r){e.next=17;break}if(!A.sG.User.checkGeetestRestricted()){e.next=6;break}return e.abrupt("return",Promise.reject());case 6:return a=(0,D.h)(),l=a.systemInfos,u=a.uuid,c=r||(s?null==l?void 0:l.geetest_captcha_id.force_geetest:null==l?void 0:l.geetest_captcha_id.login),e.next=10,A.sG.User.initGeetest({geetestConfig:{captchaId:c||""}});case 10:return p=e.sent,e.next=13,new Promise((function(e,t){null==p||p.onSuccess((function(){e(p.getValidate())})).onClose((function(){p.destroy(),t()})).onError((function(){p.destroy(),t()}))}));case 13:if(!(h=e.sent)){e.next=17;break}return e.next=17,A.sG.User.validateGeetest((0,m.Z)({account:"SMS"===this.loginType?u:t.username},h));case 17:if(o!==i.SMS_CODE_GEETEST){e.next=32;break}return e.next=20,(0,j.Z)((0,U.apiGetUserInfo)({username:t.username}));case 20:if(f=e.sent,y=(0,g.Z)(f,2),v=y[0],T=y[1],!v){e.next=26;break}return e.abrupt("return",Promise.reject(v));case 26:if(!(C=null==T||null===(d=T.data)||void 0===d?void 0:d.data)){e.next=31;break}return e.next=30,this.close();case 30:A.sG.Modal.open("veriryBindPhone",{verifyScene:R.O.LOGIN_SMS_VERIFY,formData:t,desensitizedPhoneNumber:null==C?void 0:C.phone,onSuccess:function(){var e,t;null===(e=k.openOptions)||void 0===e||null===(t=e.onLoginSuccess)||void 0===t||t.call(e)}});case 31:return e.abrupt("return",Promise.reject());case 32:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"doLogin",value:(n=(0,T.Z)((0,b.Z)().mark((function e(t){var n,o,r,i=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},o=n.code,r=n.geetCaptchaId,e.next=3,this.doLoginValidate(t,{code:o,geetCaptchaId:r});case 3:if("ACCOUNT"!==this.loginType){e.next=5;break}return e.abrupt("return",A.sG.User.login(t));case 5:if("SMS"!==this.loginType){e.next=9;break}return e.next=8,this.smsVerificationRef.valid();case 8:return e.abrupt("return",A.sG.User.smsLogin(t));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"doSubmit",value:(t=(0,T.Z)((0,b.Z)().mark((function e(){var t,n,o,r,i,s,a,l,u,c,p,h,d=this,f=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:{},n=t.code,o=t.geetCaptchaId,!this.loading){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this.formModel.validate();case 6:return this.loading=!0,s=this.loginPayloadFormat(this.form),e.next=10,this.doLogin(s,{code:n,geetCaptchaId:o}).finally((function(){d.loading=!1}));case 10:"ACCOUNT"===this.loginType&&(a=(0,K.R)(),l=a.$patch,u=s.userpass,l({isLoginedByPassword:!0,loginPass:u})),this.$route.path.includes("/event")&&this.$router.push({name:L.x4.GAME}),this.close(),null===(r=this.openOptions)||void 0===r||null===(i=r.onLoginSuccess)||void 0===i||i.call(r),(0,D.h)().$patch({isUseSystemInfoToken:O.AI.OPEN}),A.sG.Modal.close("registerModal"),A.sG.Modal.close("rechargePopup"),A.sG.Modal.close("newBenefitsModal"),e.next=27;break;case 20:e.prev=20,e.t0=e.catch(3),c=null===e.t0||void 0===e.t0?void 0:e.t0.data,p=A.CM.ServiceCode,(h=null==c?void 0:c.code)!==p.SWIPER_PUZZLE_GEETEST&&h!==p.NINE_SQUARE_GEETEST&&h!==p.GRAPHIC_CLICK_GEETEST||this.doSubmit({code:h,geetCaptchaId:c.msg}),h!==p.SMS_CODE_GEETEST&&h!==p.FORCE_GEETEST||this.doSubmit({code:h});case 27:case"end":return e.stop()}}),e,this,[[3,20]])}))),function(){return t.apply(this,arguments)})},{key:"onSubmit",value:function(){this.doSubmit()}},{key:"toggleLoginType",value:function(){this.loginType=this.loginType===h.ACCOUNT?h.SMS:h.ACCOUNT,this.loginType===h.SMS&&this.tryInitCurrentPhoneNumberSegment()}},{key:"afterClose",value:function(){var e=(0,D.h)();1===e.enterPagePopupType&&e.$patch({enterPagePopupType:0}),this.baseAfterClose()}},{key:"renderNormal",value:function(){var e,t,n,o=this,r=this.$createElement,i=(0,F.QT)().t,s=(0,D.h)(),a=A.sG.FuncRender.createFormModelItem.call(this);return r(M.T.Tsx,{attrs:{direction:"vertical",size:14}},[r(M.au.Tsx,f()([{key:this.loginType,ref:"formModel",attrs:{layout:"vertical",hideRequiredMark:!0}},{props:{rules:this.rules,model:this.form}}]),["ACCOUNT"===this.loginType?[a.username({prop:"username",model:this.form}),a.userpass({prop:"userpass",model:this.form,inputTsxData:{attrs:{autocomplete:s.rememberPwd?"current-password":"new-password"}},getRules:function(e){return[e.required,A.sG.Rules.userpass({start:6,end:16})]}})]:[(null===(e=this.loginConfig)||void 0===e?void 0:e.defaultCountry)&&a.userPhoneSelect({prop:"phone",model:this.form,countryInfos:null===(t=this.loginConfig)||void 0===t?void 0:t.countryInfos,defaultCountry:null===(n=this.loginConfig)||void 0===n?void 0:n.defaultCountry,currentPhoneNumberSegment:this.currentPhoneNumberSegment,onSelectChange:function(e){o.currentPhoneNumberSegment=e,o.form.phone=""}}),r(N.F0,{ref:"smsVerificationRef",attrs:{prop:"vcode",targetValue:this.phoneNumberFormat},model:{value:o.form.vcode,callback:function(e){o.$set(o.form,"vcode",e)}}})]]),r(M.X2.Tsx,{attrs:{type:"flex",justify:"space-between"},class:X.Z.passwordTools},[r(M.JX.Tsx,{style:{display:"flex",alignItems:"center"}},[r("div",{directives:[{name:"show",value:"ACCOUNT"===this.loginType}],class:X.Z["check-box-container"],on:{click:function(){s.$patch({rememberPwd:!s.rememberPwd})}}},[r(M.XZ.Tsx,{attrs:{checked:s.rememberPwd}}),r("span",{class:X.Z["check-box-label"]},[i("lobby.modal.login.operate.rememberPwd")])])]),r(M.JX.Tsx,[r(M.zx.Tsx,{attrs:{type:"link"},on:{click:this.toForgetPassword}},[i("lobby.modal.login.operate.forgotPwd")])])]),r(M.X2.Tsx,{attrs:{type:"flex",justify:"space-between"},class:X.Z.mainBtn},[r(M.zx.Tsx,{attrs:{block:!0,type:"primary",loading:this.loading},class:X.Z.button,on:{click:this.onSubmit}},[i("lobby.modal.login.label")])]),r(M.X2.Tsx,{attrs:{type:"flex",justify:"space-around"},class:X.Z.loginTools},[this.loginConfig.showTryItFree&&r(M.JX.Tsx,[r(M.zx.Tsx,{attrs:{type:"link"},on:{click:function(){o.close(),s.$patch({enterPagePopupType:0}),o.$router.push({name:L.x4.GAME,query:(0,m.Z)((0,m.Z)({},o.$route.query),{},{gameCategoryId:String(G.ck.DEMO)})})}}},[i("lobby.modal.login.operate.tryItFree")])]),this.loginConfig.showSMSLogin&&r(M.JX.Tsx,[r(M.zx.Tsx,{attrs:{type:"link"},on:{click:this.toggleLoginType}},["ACCOUNT"===this.loginType?i("lobby.modal.login.operate.smsLogin"):i("lobby.modal.login.operate.accountLogin")])]),this.loginConfig.showRegisterAccount&&r(M.JX.Tsx,[r(M.zx.Tsx,{attrs:{type:"link"},on:{click:this.toRegister}},[i("lobby.modal.login.operate.registerAccount")])])]),s.threeWayConfig.list.length>0?r(z.ZP,{class:X.Z.threeWayLogin,attrs:{threeWayConfig:s.threeWayConfig.list}}):null])}},{key:"created",value:function(){this.autoUsername()}},{key:"autoUsername",value:function(){if("SMS"!==this.loginType){var e=(0,D.h)(),t=e.isTryMode,n=e.userInfos;null!=n&&n.platfromid&&!t&&(this.form.username=null==n?void 0:n.platfromid)}}},{key:"render",value:function(){var e=this,t=arguments[0],n=(0,D.h)(),o=n.isWeb;return this.renderModal({modalConfig:{class:[X.Z.main,"loginModal"],props:{width:o?V.ZP.px2rem(550):V.ZP.px2rem(600)}},renderContent:function(){return t(M.mQ.Tsx,{class:X.Z.tabs,model:{value:e.activeKey,callback:function(t){e.activeKey=t}}},[e.tabsData.map((function(e){var n=e.key,o=e.tab,r=e.renderContent;return t(M.mQ.TabPane.Tsx,{key:n,attrs:{tab:o}},[r()])}))])}})}}]),l}(W.Z),c=(0,E.Z)(u.prototype,"formModel",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=(0,E.Z)(u.prototype,"smsVerificationRef",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,E.Z)(u.prototype,"onSubmit",[s,a],Object.getOwnPropertyDescriptor(u.prototype,"onSubmit"),u.prototype),l=u))||l)}}]);